var t=function(t,e,i){return"__BASE"===i?`${t},${e}`:`${i}_${t},${e}`},e=function(t){var i,s,r;if(null==t||"object"!=typeof t)return t;if(i=Array.isArray(t)?[]:{},function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0}(t))for(r in t)s=t[r],i[r]=e(s);else i=t;return i};const i=Phaser.Utils.Objects.IsPlainObject,s=Phaser.Utils.Objects.GetValue;var r=function(t){return"string"==typeof t&&(t=a[t]),t};const a={scale:0,repeat:1};var n=function(t,e){return 0===t||t===this.columns.count-1||0===e||e===this.rows.count-1},o=function(){},h={_beginDraw:o,_drawImage:o,_drawTileSprite:o,_endDraw:o,setGetFrameNameCallback:function(e){return void 0===e&&(e=t),this.getFrameNameCallback=e,this},setBaseTexture:function(t,i,s,r){Array.isArray(i)&&(r=s,s=i,i=void 0),null==i&&(i="__BASE"),"number"==typeof s&&arguments.length>=6?(s=[arguments[2],void 0,arguments[3]],r=[arguments[4],void 0,arguments[5]]):(s=e(s),r=e(r)),this.textureKey=t,this.baseFrameName=i,this.columns.data=s,this.columns.count=s?s.length:0,this.columns.stretch=0,this.columns.minWidth=0,this.columns.scale=1,this.rows.data=r,this.rows.count=r?r.length:0,this.rows.stretch=0,this.rows.minHeight=0,this.rows.scale=1;var a=this.scene.sys.textures.get(t);if(!a)return this.clear(),this;if(!s||!r)return this.clear(),this;for(var n=a.get(i),o=n.width,h=0,c=0,u=s.length;c<u;c++)void 0===s[c]?h++:"number"==typeof s[c]?o-=s[c]:o-=s[c].width;var d=o/h,l=n.height,v=0;for(c=0,u=r.length;c<u;c++)void 0===r[c]?v++:"number"==typeof r[c]?l-=r[c]:l-=r[c].width;for(var m,f,g,w,p,y=l/v,x=0,b=0,P=0,S=r.length;P<S;P++){void 0===r[P]&&(r[P]=y),"number"==typeof r[P]&&(r[P]={height:r[P],stretch:P%2}),g=(m=r[P]).height,this.rows.stretch+=0|m.stretch,this.rows.minHeight+=m.stretch>0?0:g,x=0;c=0;for(var F=s.length;c<F;c++){if(void 0===s[c]&&(s[c]=d),"number"==typeof s[c]&&(s[c]={width:s[c],stretch:c%2}),w=(f=s[c]).width,0===P&&(this.columns.stretch+=0|f.stretch,this.columns.minWidth+=f.stretch>0?0:w),w>=1&&g>=1){var j=typeof(p=this.getFrameNameCallback(c,P,i));"string"!==j&&"number"!==j||a.add(p,0,x+n.cutX,b+n.cutY,w,g)}x+=w}b+=g}return this.updateTexture(),this},updateTexture:function(){if(this.clear(),void 0===this.textureKey)return this;var t=this.scene.sys.textures.get(this.textureKey);if(!t)return this;var e,i,s,r,a,n,o,h=this.columns.minWidth*this.maxFixedPartScaleX,c=this.rows.minHeight*this.maxFixedPartScaleY,u=this.width-h,d=this.height-c,l=u>=0?this.maxFixedPartScaleX:this.width/h,v=d>=0?this.maxFixedPartScaleY:this.height/c;if(this.preserveRatio){var m=Math.min(l,v);if(l>m){var f=(l-m)*h;u>=0?u+=f:u=f,l=m}if(v>m){var g=(v-m)*c;d>=0?d+=g:d=g,v=m}}this.columns.scale=l,this.rows.scale=v,e=u>0&&this.columns.stretch>0?u/this.columns.stretch:0,i=d>0&&this.rows.stretch>0?d/this.rows.stretch:0;var w=0,p=0;this._beginDraw();for(var y=0,x=this.rows.count;y<x;y++){o=0===(a=this.rows.data[y]).stretch?a.height*v:i*a.stretch,w=0;for(var b=0,P=this.columns.count;b<P;b++)n=0===(r=this.columns.data[b]).stretch?r.width*l:e*r.stretch,s=this.getFrameNameCallback(b,y,this.baseFrameName),t.has(s)&&n>0&&o>0&&(0===(0===a.stretch&&0===r.stretch||0===this.getStretchMode(b,y)?0:1)?this._drawImage(this.textureKey,s,w,p,n,o):this._drawTileSprite(this.textureKey,s,w,p,n,o)),w+=n;p+=o}this._endDraw()},setStretchMode:function(t){return i(t)?(this.stretchMode.edge=r(s(t,"edge",0)),this.stretchMode.internal=r(s(t,"internal",0))):(t=r(t),this.stretchMode.edge=t,this.stretchMode.internal=t),this},getStretchMode:function(t,e){return n.call(this,t,e)?this.stretchMode.edge:this.stretchMode.internal},setPreserveRatio:function(t){return null==t&&(t=!0),this.preserveRatio=t,this},setMaxFixedPartScale:function(t,e){return void 0===e&&(e=t),this.maxFixedPartScaleX=t,this.maxFixedPartScaleY=e,this}};const c=Phaser.Utils.Objects.IsPlainObject,u=Phaser.Utils.Objects.GetValue;const d=Phaser.Game;var l=function(t){return t instanceof d};const v=Phaser.Scene;var m=function(t){return t instanceof v},f=function(t){return null==t||"object"!=typeof t?null:l(t)?t:l(t.game)?t.game:m(t)?t.sys.game:m(t.scene)?t.scene.sys.game:void 0};const g=Phaser.GameObjects;var w=void 0,p=function(t,e){if(w||(w={},f(t).events.once("destroy",(function(){for(var t in w)w[t].destroy();w=void 0}))),!w.hasOwnProperty(e)){var i=f(t).scene.systemScene;(t=new g[e](i)).setOrigin(0),w[e]=t}return w[e]};const y=Phaser.GameObjects.RenderTexture;class x extends(function(t,e){class i extends t{constructor(t,i,s,r,a,n,o,h,d,l){if(c(i)?(i=u(l=i,"x",0),s=u(l,"y",0),r=u(l,"width",1),a=u(l,"height",1),n=u(l,"key",void 0),o=u(l,"baseFrame",void 0),h=u(l,"columns",void 0),d=u(l,"rows",void 0)):c(r)?(r=u(l=r,"width",1),a=u(l,"height",1),n=u(l,"key",void 0),o=u(l,"baseFrame",void 0),h=u(l,"columns",void 0),d=u(l,"rows",void 0)):c(n)?(n=u(l=n,"key",void 0),o=u(l,"baseFrame",void 0),h=u(l,"columns",void 0),d=u(l,"rows",void 0)):c(o)?(o=u(l=o,"baseFrame",void 0),h=u(l,"columns",void 0),d=u(l,"rows",void 0)):Array.isArray(o)?(l=d,d=h,h=o,o=u(l,"baseFrame",void 0)):c(h)&&(h=u(l=h,"columns",void 0),d=u(l,"rows",void 0)),void 0===h){var v=u(l,"leftWidth",void 0),m=u(l,"rightWidth",void 0);void 0!==v&&void 0!==m&&(h=[v,void 0,m])}if(void 0===d){var f=u(l,"topHeight",void 0),g=u(l,"bottomHeight",void 0);void 0!==f&&void 0!==g&&(d=[f,void 0,g])}super(t),this.type=e,this.setPosition(i,s).setSize(r,a).setOrigin(.5,.5),this.columns={},this.rows={},this.stretchMode={},this._tileSprite=void 0,this._image=void 0,this.setGetFrameNameCallback(u(l,"getFrameNameCallback",void 0)),this.setStretchMode(u(l,"stretchMode",0)),this.setPreserveRatio(u(l,"preserveRatio",!0));var w=u(l,"maxFixedPartScale",1),p=u(l,"maxFixedPartScaleX",w),y=u(l,"maxFixedPartScaleY",void 0);this.setMaxFixedPartScale(p,y),this.setBaseTexture(n,o,h,d)}get minWidth(){return this.columns.minWidth}get minHeight(){return this.rows.minHeight}get fixedPartScaleX(){return this.columns.scale}get fixedPartScaleY(){return this.rows.scale}resize(t,e){return this.width===t&&this.height===e||(super.resize?super.resize(t,e):super.setSize(t,e),this.updateTexture()),this}}return Object.assign(i.prototype,h),i}(y,"rexNinePatch")){}var b={_beginDraw:y.prototype.beginDraw,_endDraw:y.prototype.endDraw,_drawImage:function(t,e,i,s,r,a){var n=p(this,"Image").setTexture(t,e).setDisplaySize(r,a);this.batchDraw(n,i,s)},_drawTileSprite:function(t,e,i,s,r,a){var n=p(this,"TileSprite").setTexture(t,e).setSize(r,a);this.batchDraw(n,i,s)}};function P(t,e,i,s,r,a,n,o,h){var c=new x(this.scene,t,e,i,s,r,a,n,o,h);return this.scene.add.existing(c),c}Object.assign(x.prototype,b);const S=Phaser.GameObjects.BuildGameObject;function F(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=new x(this.scene,t);return S(this.scene,i,t),i}var j=function(t){return null==t||""===t||0===t.length};class O extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexNinePatch",P,F)}start(){this.game.events.on("destroy",this.destroy,this)}}!function(t,e,i,s){if(void 0===s&&(s="."),"object"==typeof t){if(j(e)){if(null==i)return;"object"==typeof i&&(t=i)}else{"string"==typeof e&&(e=e.split(s));var r=e.pop(),a=function(t,e,i){var s=t;if(j(e));else{var r;"string"==typeof e&&(e=e.split("."));for(var a=0,n=e.length;a<n;a++){var o;null!=s[r=e[a]]&&"object"==typeof s[r]||(o=a===n-1?void 0===i?{}:i:{},s[r]=o),s=s[r]}}return s}(t,e);a[r]=i}}}(window,"RexPlugins.GameObjects.NinePatch",x);export{O as default};
